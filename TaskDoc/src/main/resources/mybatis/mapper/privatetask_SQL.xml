<?xml version="1.0" encoding="UTF-8"?>
	<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 다른 mapper과 중복 되지 않도록 네임스페이스 기재 -->
<mapper namespace="privatetask_SQL">

	<select id="codelist" resultType="privatetask">
		SELECT * FROM privatetask WHERE tcode=#{tcode} AND uid=#{uid} ORDER BY ptrefference ASC, ptsequence ASC;
	</select>
	
	<select id="idlist" resultType="privatetask">
		SELECT * FROM privatetask WHERE uid=#{uid} ORDER BY ptrefference ASC, ptsequence ASC;
	</select>
	
	<select id="selfRefMax" resultType="Integer">
	 	SELECT MAX(ptsequence) FROM privatetask WHERE tcode=#{tcode} AND ptcode=ptrefference;
	</select>
	
	<select id="sameRefMax" resultType="Integer">
	 	SELECT MAX(ptsequence) FROM privatetask WHERE ptrefference=#{ptrefference} AND NOT ptcode=ptrefference;
	</select>
	
	<insert id="insert" parameterType="privatetask" useGeneratedKeys="true" keyProperty="ptcode">
		INSERT INTO privatetask VALUES(null, #{pttitle}, #{ptcolor}, #{ptsdate}, #{ptedate}, 0, 0, 
		<choose>
			<when test="ptrefference != 0">
				#{ptrefference}
			</when>
			<otherwise>
				null
			</otherwise>
		</choose>, #{tcode}, #{uid})
	</insert>
	
	<update id="update" parameterType="privatetask">
		UPDATE privatetask SET pttitle=#{pttitle}, ptcolor=#{ptcolor}, ptsdate=#{ptsdate}, ptedate=#{ptedate}, ptpercent=#{ptpercent}, 
				ptsequence=#{ptsequence}, ptrefference=#{ptrefference} WHERE ptcode=#{ptcode}
	</update>
	
	<delete id="delete">
		DELETE FROM privatetask WHERE ptcode=#{ptcode}
	</delete>
</mapper>
	